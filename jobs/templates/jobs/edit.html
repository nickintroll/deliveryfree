{% extends 'base.html' %}

{% block content %}
<br>
<br>
<div class="content-width centered">
	<form method="post" id="job-edit-form-h">
		<div class="inline-bastards">
			<h1>
				<span id="title-field-target">
					{{ job|title }}
				</span>
				<div class="hidden" id="title-field-place">
					{{ form.job_title }}
				</div>
			</h1>
			<div class="edit-but" id="title-field">
				edit
			</div>
			<div class="half-tab">
				Creator: <strong>{{ request.user }}</strong>
			</div>
		</div>	
		<div class="block">
			<h5>
				<span id="location-field-target">
					{{ job.location|title }} 
				</span>
				<span class="hidden" id="location-field-place">
					{{ form.location }}
				</span>
				
				<span class="edit-but" id="location-field">
					edit
				</span>
				| <span class="fade-text">created: {{ job.created.date }}</span>
			</h5>
			<div class="inline-bastards">
				<h3 id="salary-field-target">
					{{ job.salary }}p
				</h3>
				<span class="hidden" id="salary-field-place">
					{{ form.salary }}
				</span>
				<span class="edit-but" id="salary-field">
					edit
				</span>



				<span class="half-tab inline-bastards">
					(<h4 id="type-field-target">
						{{ job.type }}
						
					</h4>
					<span class="hidden" id="type-field-place">
						{{ form.type }}
					</span>

					)
					<span class="edit-but" id="type-field">
						edit
					</span>	
				</span>
			</div>
			<div class="gray-back">
				<div class="inline-bastards inline-top">
					<span class="hidden" id="description-field-place">
						{{ form.description }}
					</span>
					<span id="description-field-target">
						{{ job.description|linebreaks }}
					</span>		
					<span class="edit-but" id="description-field">
						edit
					</span>

				</div>
			</div>
			<br>
			<br>
			<h3>
				Requirements:
			</h3>
			<span class="" id="">
				{% for req in reqs %}
					<div class="inline-bastards">
						<input type="checkbox" value="{{ req.pk }}" name="reqs{{ req.pk }}">
						<div>
							{{ req|title }}
						</div>
					</div>					
				{% endfor %}
			</span>

			<div class="inline-bastards requirements" id="requirements-field-target">
				{% for req in job.requirements.all %}
					<div>
						{{ req }}
					</div>
				{% endfor %}
			</div>
		</div>
		<br>
		<div>
			{{ form.status }}
		</div>

		{% csrf_token %}
		<div>
			<input type="submit" value="Save changes" form="job-edit-form-h" class="edit-but-save stick-to-right">
		</div>
	</form>

</div>
<br>
<br>
<br>
{% endblock %}

{% block afterbody %}
<script>
	var buts = document.getElementsByClassName('edit-but');
	for (let i=0; i < buts.length; i++){
		buts[i].onclick = function(e) {

			let place = document.getElementById(e.target.id + '-place');
			let target = document.getElementById(e.target.id + '-target');
			

			if (e.target.textContent.replaceAll('\n', '').replaceAll('\t', '')=='edit'){
				// opening field
				place.style['display']='inline-block';
				target.style['display'] = 'none';

				if (place.getElementsByTagName('input').length > 0) {
					place.getElementsByTagName('input')[0].focus();
				} else {
					if (place.getElementsByTagName('textarea').length > 0) {
						place.getElementsByTagName('textarea')[0].focus();
					};
				}

				e.target.innerHTML = 'commit'
			} else {
				// closing field
				place.style['display']= 'none';


				if (place.getElementsByTagName('input').length > 0) {
					target.innerHTML = place.getElementsByTagName('input')[0].value;
				} else {
					if (place.getElementsByTagName('select').length > 0) {

						let thing = place.getElementsByTagName('select')[0];
						if (thing) {
							if (thing.value != '') {
								if (e.target.id.includes('requirements')) {
									target.innerHTML = thing.options[thing.value-1].text;	
								} else {
									target.innerHTML = thing.options[thing.value].text;
								}
							}
						}

					} else {
						if (place.getElementsByTagName('textarea').length > 0) {
							let thing = place.getElementsByTagName('textarea')[0];
							target.innerHTML = place.getElementsByTagName('textarea')[0].value;

						}
					}
				}
	
				target.style['display'] = 'inline-block';
				
				e.target.innerHTML = 'edit'
			}

		}
	}
</script>

{% endblock %}
